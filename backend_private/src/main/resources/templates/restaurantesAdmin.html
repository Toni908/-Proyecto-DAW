<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <link th:href="@{/css/custom.css}" rel="stylesheet"/>
  <link th:href="@{/css/form.css}" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css"/>
</head>
<body>
<div th:insert="shared/headerVersion2 :: header" class="sticky-top top-0"></div>
<form id="form" th:action="@{/restaurant/validation}" method="POST">
  <main class="pt-3 mx-auto w-75">
    <div id="restaurantes">
      <h3 class="mt-5">Restaurantes</h3>
      <table id="restaurant_table" class="display" style="width:100%">
        <thead class="thead-dark">
        <th scope="row">Id</th>
        <th scope="row">Name</th>
        <th scope="row">Dies Anticipacion</th>
        <th scope="row">Telefono</th>
        <th scope="row">Validated</th>
        <th scope="row">Aforo</th>
        <th scope="row">Direccion</th>
        <th scope="row">localidad</th>
        <th scope="row">membresia</th>
        <th scope="row">useracount</th>
        <th scope="row">visible</th>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>
    <label>
      <input type="text" name="idRestaurant" hidden>
    </label>
    <label>
      <input type="checkbox" name="validation" hidden>
    </label>
  </main>
</form>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
<script th:src="@{/js/header.js}"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>
<script>
  $.getJSON("/get/restaurantes/admin/json", function (dataRetaurante) {
    var table = $('#restaurant_table').dataTable({
      data: dataRetaurante,

      columns: [
        {"data": "id_restaurante"},
        {"data": "nombre"},
        {"data": "dies_anticipacion_reservas"},
        {"data": "telefono_restaurante"},
        {
          "data": "validated",
          render: function (data) {
            if (data === true) {
              return '                            <div class="form-check form-switch d-flex flex-row justify-content-center p-0 m-0">' +
                      '                                <label class="w-100 d-flex flex-row justify-content-center">' +
                      '                                    <input class="form-check-input m-0 fs-3 validar" type="checkbox" name="validar" checked>' +
                      '                                </label>' +
                      '                            </div>'
            } else {
              return '                            <div class="form-check form-switch d-flex flex-row justify-content-center p-0 m-0">' +
                      '                                <label class="w-100 d-flex flex-row justify-content-center">' +
                      '                                    <input class="form-check-input m-0 fs-3 validar" type="checkbox" name="validar">' +
                      '                                </label>' +
                      '                            </div>'
            }
          }
        },
        {"data": "aforo"},
        {"data": "direccion"},
        {"data": "localidad.nombre_localidad"},
        {"data": "membresia.id_membresia", "defaultContent": "<i>Not set</i>"},
        {"data": "useracount.nombre_usuario"},
        {
          "data": "visible",
          render: function (data) {
            if (data === true) {
              return '                            <div class="form-check form-switch d-flex flex-row justify-content-center p-0 m-0">' +
                      '                                <label class="w-100 d-flex flex-row justify-content-center">' +
                      '                                    <input class="form-check-input m-0 fs-3" type="checkbox" name="validado" checked disabled="disabled">' +
                      '                                </label>' +
                      '                            </div>'
            } else {
              return '                            <div class="form-check form-switch d-flex flex-row justify-content-center p-0 m-0">' +
                      '                                <label class="w-100 d-flex flex-row justify-content-center">' +
                      '                                    <input class="form-check-input m-0 fs-3" type="checkbox" onchange="this.form.submit()" name="validado" disabled="disabled">' +
                      '                                </label>' +
                      '                            </div>'
            }
          }
        }
      ]
    });
  });

  $(document).ready(function() {
    $(".body").hide();
    setTimeout(function () {
      $(".body").show();
      $(".validar").on('click', function () {
        let object = this.closest("tr");
        // let value = this.closest('tr').innerText;
        this.closest('input').name = "validationResponse"
        $("input[name=idRestaurant]").val(object.firstChild.innerText)
        $("#form").submit();
      });
    },1000);
  });

</script>
</body>
</html>